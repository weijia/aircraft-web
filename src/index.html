<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>飞行射击游戏</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      text-align: center;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    #gameCanvas {
      display: block;
      background-color: #000;
      border: 2px solid #444;
      margin: 0 auto;
    }

    .game-wrapper {
      position: relative;
      width: 800px;
      height: 600px;
      margin: 0 auto;
    }
    
    .controls {
      margin-top: 20px;
      padding: 10px;
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: inline-block;
    }
    
    button {
      padding: 8px 16px;
      margin: 0 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    .score-display {
      font-size: 24px;
      margin-top: 10px;
      font-weight: bold;
    }
    
    .instructions {
      margin-top: 20px;
      padding: 10px;
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    
    .instructions h2 {
      color: #333;
      margin-top: 0;
    }
    
    .instructions ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <h1>飞行射击游戏</h1>
  
  <div class="game-wrapper">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
  </div>
  
  <div class="score-display">
    分数: <span id="scoreValue">0</span>
  </div>
  
  <div class="controls">
    <button id="startButton">开始游戏</button>
    <button id="pauseButton">暂停</button>
    <button id="resetButton">重置</button>
  </div>
  
  <div class="instructions">
    <h2>游戏说明</h2>
    <ul>
      <li>使用方向键控制飞机移动</li>
      <li>按空格键发射子弹</li>
      <li>击中敌机可得分</li>
      <li>避免被敌机撞击</li>
    </ul>
  </div>

  <script>
    // 游戏变量
    let canvas, ctx;
    let gameRunning = false;
    let score = 0;
    
    // 玩家
    const player = {
      x: 400,
      y: 500,
      width: 50,
      height: 50,
      speed: 5,
      color: '#3498db',
      powerLevel: 0, // 能量等级
      powerMaxLevel: 3 // 最大能量等级
    };
    
    // 子弹数组
    const bullets = [];
    const bulletSpeed = 7;
    const bulletCooldown = 300; // 毫秒
    let lastBulletTime = 0;
    
    // 敌机数组
    const enemies = [];
    const enemySpeed = 3;
    const enemySpawnRate = 1500; // 毫秒
    let lastEnemySpawn = 0;
    
    // 道具数组
    const powerups = [];
    const powerupSpeed = 2;
    const powerupTypes = [
      { name: '速度提升', color: '#2ecc71', effect: 'speed' },
      { name: '范围扩大', color: '#9b59b6', effect: 'spread' }
    ];
    
    // 背景星星
    const stars = [];
    const starCount = 100;
    const starSpeed = 2;
    
    // 按键状态
    const keys = {
      left: false,
      right: false,
      up: false,
      down: false,
      space: false
    };
    
    // 初始化游戏
    function init() {
      canvas = document.getElementById('gameCanvas');
      ctx = canvas.getContext('2d');
      
      // 设置事件监听器
      document.getElementById('startButton').addEventListener('click', startGame);
      document.getElementById('pauseButton').addEventListener('click', pauseGame);
      document.getElementById('resetButton').addEventListener('click', resetGame);
      
      // 键盘事件
      window.addEventListener('keydown', handleKeyDown);
      window.addEventListener('keyup', handleKeyUp);
      
      // 初始化星星背景
      initStars();
      
      // 初始绘制
      drawGame();
    }
    
    // 初始化星星背景
    function initStars() {
      stars.length = 0;
      for (let i = 0; i < starCount; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 3 + 1,
          speed: Math.random() * 2 + 1,
          brightness: Math.random() * 0.5 + 0.5
        });
      }
    }
    
    // 开始游戏
    function startGame() {
      if (!gameRunning) {
        gameRunning = true;
        gameLoop();
      }
    }
    
    // 暂停游戏
    function pauseGame() {
      gameRunning = false;
    }
    
    // 重置游戏
    function resetGame() {
      gameRunning = false;
      score = 0;
      updateScore();
      
      // 重置玩家位置和能量等级
      player.x = canvas.width / 2;
      player.y = canvas.height - 100;
      player.powerLevel = 0;
      
      // 清空子弹、敌机和道具
      bullets.length = 0;
      enemies.length = 0;
      powerups.length = 0;
      
      // 重绘
      drawGame();
    }
    
    // 处理按键按下
    function handleKeyDown(e) {
      switch(e.key) {
        case 'ArrowLeft':
          keys.left = true;
          break;
        case 'ArrowRight':
          keys.right = true;
          break;
        case 'ArrowUp':
          keys.up = true;
          break;
        case 'ArrowDown':
          keys.down = true;
          break;
        case ' ':
          keys.space = true;
          break;
      }
    }
    
    // 处理按键释放
    function handleKeyUp(e) {
      switch(e.key) {
        case 'ArrowLeft':
          keys.left = false;
          break;
        case 'ArrowRight':
          keys.right = false;
          break;
        case 'ArrowUp':
          keys.up = false;
          break;
        case 'ArrowDown':
          keys.down = false;
          break;
        case ' ':
          keys.space = false;
          break;
      }
    }
    
    // 更新游戏状态
    function update() {
      // 更新星星背景
      updateStars();
      
      // 移动玩家
      if (keys.left) player.x -= player.speed;
      if (keys.right) player.x += player.speed;
      if (keys.up) player.y -= player.speed;
      if (keys.down) player.y += player.speed;
      
      // 限制玩家在画布内
      player.x = Math.max(player.width / 2, Math.min(canvas.width - player.width / 2, player.x));
      player.y = Math.max(player.height / 2, Math.min(canvas.height - player.height / 2, player.y));
      
      // 移动道具
      for (let i = powerups.length - 1; i >= 0; i--) {
        powerups[i].y += powerupSpeed;
        
        // 移除超出画布的道具
        if (powerups[i].y - powerups[i].size > canvas.height) {
          powerups.splice(i, 1);
        }
      }
      
    // 发射子弹
      const currentTime = Date.now();
      if (keys.space && currentTime - lastBulletTime > bulletCooldown) {
        // 根据能量等级发射不同数量和类型的子弹
        switch(player.powerLevel) {
          case 0: // 基础子弹
            bullets.push({
              x: player.x,
              y: player.y - player.height / 2,
              width: 5,
              height: 15,
              color: '#f1c40f',
              speed: bulletSpeed
            });
            break;
          case 1: // 双子弹
            bullets.push({
              x: player.x - 10,
              y: player.y - player.height / 2,
              width: 5,
              height: 15,
              color: '#f1c40f',
              speed: bulletSpeed + 1
            });
            bullets.push({
              x: player.x + 10,
              y: player.y - player.height / 2,
              width: 5,
              height: 15,
              color: '#f1c40f',
              speed: bulletSpeed + 1
            });
            break;
          case 2: // 三子弹
            bullets.push({
              x: player.x,
              y: player.y - player.height / 2,
              width: 5,
              height: 15,
              color: '#f1c40f',
              speed: bulletSpeed + 2
            });
            bullets.push({
              x: player.x - 15,
              y: player.y - player.height / 3,
              width: 5,
              height: 15,
              color: '#f1c40f',
              speed: bulletSpeed + 2
            });
            bullets.push({
              x: player.x + 15,
              y: player.y - player.height / 3,
              width: 5,
              height: 15,
              color: '#f1c40f',
              speed: bulletSpeed + 2
            });
            break;
          case 3: // 散弹
            for (let i = -2; i <= 2; i++) {
              bullets.push({
                x: player.x + i * 10,
                y: player.y - player.height / 2,
                width: 5,
                height: 15,
                color: '#f1c40f',
                speed: bulletSpeed + 3
              });
            }
            break;
        }
        lastBulletTime = currentTime;
      }
      
      // 移动子弹
      for (let i = bullets.length - 1; i >= 0; i--) {
        // 使用子弹自身速度，而不是全局速度
        bullets[i].y -= bullets[i].speed || bulletSpeed;
        
        // 移除超出画布的子弹
        if (bullets[i].y + bullets[i].height < 0) {
          bullets.splice(i, 1);
        }
      }
      
      // 生成敌机
      if (currentTime - lastEnemySpawn > enemySpawnRate) {
        // 随机决定是否生成能掉落道具的特殊敌机（20%几率）
        const isSpecial = Math.random() < 0.2;
        
        enemies.push({
          x: Math.random() * (canvas.width - 40) + 20,
          y: -30,
          width: isSpecial ? 50 : 40, // 特殊敌机更大
          height: isSpecial ? 50 : 40,
          color: isSpecial ? '#f39c12' : '#e74c3c', // 特殊敌机为橙色
          isSpecial: isSpecial, // 标记是否为特殊敌机
          hasPowerup: isSpecial // 只有特殊敌机会掉落道具
        });
        
        lastEnemySpawn = currentTime;
      }
      
      // 移动敌机
      for (let i = enemies.length - 1; i >= 0; i--) {
        enemies[i].y += enemySpeed;
        
        // 移除超出画布的敌机
        if (enemies[i].y - enemies[i].height > canvas.height) {
          enemies.splice(i, 1);
        }
      }
      
      // 碰撞检测
      checkCollisions();
    }
    
    // 碰撞检测
    function checkCollisions() {
      // 子弹与敌机碰撞
      for (let i = bullets.length - 1; i >= 0; i--) {
        for (let j = enemies.length - 1; j >= 0; j--) {
          if (isColliding(bullets[i], enemies[j])) {
            // 增加分数（特殊敌机得分更高）
            score += enemies[j].isSpecial ? 30 : 10;
            updateScore();
            
            // 如果是特殊敌机，则掉落道具
            if (enemies[j].hasPowerup) {
              const powerupType = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
              powerups.push({
                x: enemies[j].x,
                y: enemies[j].y,
                size: 15,
                color: powerupType.color,
                type: powerupType.effect
              });
            }
            
            // 移除子弹和敌机
            bullets.splice(i, 1);
            enemies.splice(j, 1);
            break;
          }
        }
      }
      
      // 玩家与敌机碰撞
      for (let i = enemies.length - 1; i >= 0; i--) {
        if (isColliding(player, enemies[i])) {
          // 游戏结束
          gameRunning = false;
          alert('游戏结束！你的分数是: ' + score);
          resetGame();
          break;
        }
      }
      
      // 玩家与道具碰撞
      for (let i = powerups.length - 1; i >= 0; i--) {
        const powerup = powerups[i];
        if (
          player.x - player.width/2 < powerup.x + powerup.size &&
          player.x + player.width/2 > powerup.x - powerup.size &&
          player.y - player.height/2 < powerup.y + powerup.size &&
          player.y + player.height/2 > powerup.y - powerup.size
        ) {
          // 应用道具效果
          applyPowerup(powerup.type);
          
          // 移除道具
          powerups.splice(i, 1);
        }
      }
    }
    
    // 应用道具效果
    function applyPowerup(type) {
      // 增加能量等级，但不超过最大等级
      if (player.powerLevel < player.powerMaxLevel) {
        player.powerLevel++;
      }
      
      // 显示提示信息
      const message = type === 'speed' ? '子弹速度提升！' : '子弹范围扩大！';
      showMessage(message);
    }
    
    // 显示提示信息
    function showMessage(text) {
      const messageElement = document.createElement('div');
      messageElement.textContent = text;
      messageElement.style.position = 'absolute';
      messageElement.style.left = '50%';
      messageElement.style.top = '20%';
      messageElement.style.transform = 'translate(-50%, -50%)';
      messageElement.style.color = 'white';
      messageElement.style.fontSize = '24px';
      messageElement.style.fontWeight = 'bold';
      messageElement.style.textShadow = '0 0 5px black';
      messageElement.style.zIndex = '1000';
      
      document.querySelector('.game-wrapper').appendChild(messageElement);
      
      // 2秒后移除提示
      setTimeout(() => {
        messageElement.remove();
      }, 2000);
    }
    
    // 碰撞检测辅助函数
    function isColliding(obj1, obj2) {
      return (
        obj1.x - obj1.width/2 < obj2.x + obj2.width/2 &&
        obj1.x + obj1.width/2 > obj2.x - obj2.width/2 &&
        obj1.y - obj1.height/2 < obj2.y + obj2.height/2 &&
        obj1.y + obj1.height/2 > obj2.y - obj2.height/2
      );
    }
    
    // 更新星星背景
    function updateStars() {
      for (let i = 0; i < stars.length; i++) {
        // 移动星星
        stars[i].y += stars[i].speed;
        
        // 如果星星移出画布底部，重新放置到顶部
        if (stars[i].y > canvas.height) {
          stars[i].y = 0;
          stars[i].x = Math.random() * canvas.width;
        }
      }
    }
    
    // 绘制游戏
    function drawGame() {
      // 清空画布
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // 绘制星星背景
      drawStars();
      
      // 绘制玩家
      drawPlayer();
      
      // 绘制子弹
      drawBullets();
      
      // 绘制敌机
      drawEnemies();
      
      // 绘制道具
      drawPowerups();
      
      // 绘制能量等级
      drawPowerLevel();
    }
    
    // 绘制道具
    function drawPowerups() {
      powerups.forEach(powerup => {
        ctx.fillStyle = powerup.color;
        ctx.beginPath();
        ctx.arc(powerup.x, powerup.y, powerup.size, 0, Math.PI * 2);
        ctx.fill();
        
        // 绘制闪光效果
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(powerup.x, powerup.y, powerup.size * 0.7, 0, Math.PI * 2);
        ctx.stroke();
      });
    }
    
    // 绘制能量等级
    function drawPowerLevel() {
      ctx.fillStyle = 'white';
      ctx.font = '16px Arial';
      ctx.fillText(`能量等级: ${player.powerLevel}`, 20, 30);
      
      // 绘制能量条
      const barWidth = 100;
      const barHeight = 10;
      const x = 120;
      const y = 22;
      
      // 背景
      ctx.fillStyle = '#444';
      ctx.fillRect(x, y, barWidth, barHeight);
      
      // 能量
      const fillWidth = (player.powerLevel / player.powerMaxLevel) * barWidth;
      ctx.fillStyle = '#3498db';
      ctx.fillRect(x, y, fillWidth, barHeight);
      
      // 边框
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 1;
      ctx.strokeRect(x, y, barWidth, barHeight);
    }
    
    // 绘制星星背景
    function drawStars() {
      for (let i = 0; i < stars.length; i++) {
        const star = stars[i];
        ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    
    // 绘制玩家
    function drawPlayer() {
      ctx.fillStyle = player.color;
      
      // 绘制三角形飞机
      ctx.beginPath();
      ctx.moveTo(player.x, player.y - player.height/2);
      ctx.lineTo(player.x + player.width/2, player.y + player.height/2);
      ctx.lineTo(player.x - player.width/2, player.y + player.height/2);
      ctx.closePath();
      ctx.fill();
    }
    
    // 绘制子弹
    function drawBullets() {
      bullets.forEach(bullet => {
        ctx.fillStyle = bullet.color;
        ctx.fillRect(
          bullet.x - bullet.width/2,
          bullet.y - bullet.height/2,
          bullet.width,
          bullet.height
        );
      });
    }
    
    // 绘制敌机
    function drawEnemies() {
      enemies.forEach(enemy => {
        ctx.fillStyle = enemy.color;
        
        if (enemy.isSpecial) {
          // 绘制特殊敌机（六边形）
          ctx.beginPath();
          const sides = 6;
          const size = enemy.width / 2;
          ctx.moveTo(enemy.x + size * Math.cos(0), enemy.y + size * Math.sin(0));
          
          for (let i = 1; i <= sides; i++) {
            const angle = i * 2 * Math.PI / sides;
            ctx.lineTo(enemy.x + size * Math.cos(angle), enemy.y + size * Math.sin(angle));
          }
          
          ctx.closePath();
          ctx.fill();
          
          // 添加闪光效果
          ctx.strokeStyle = 'white';
          ctx.lineWidth = 2;
          ctx.stroke();
          
          // 添加能量标记
          ctx.fillStyle = '#f1c40f';
          ctx.beginPath();
          ctx.arc(enemy.x, enemy.y, enemy.width / 6, 0, Math.PI * 2);
          ctx.fill();
        } else {
          // 绘制普通敌机（倒三角形）
          ctx.beginPath();
          ctx.moveTo(enemy.x, enemy.y + enemy.height/2);
          ctx.lineTo(enemy.x + enemy.width/2, enemy.y - enemy.height/2);
          ctx.lineTo(enemy.x - enemy.width/2, enemy.y - enemy.height/2);
          ctx.closePath();
          ctx.fill();
        }
      });
    }
    
    // 更新分数显示
    function updateScore() {
      document.getElementById('scoreValue').textContent = score;
    }
    
    // 游戏循环
    function gameLoop() {
      if (gameRunning) {
        update();
        drawGame();
        requestAnimationFrame(gameLoop);
      }
    }
    
    // 页面加载完成后初始化游戏
    window.addEventListener('load', init);
  </script>
</body>
</html>